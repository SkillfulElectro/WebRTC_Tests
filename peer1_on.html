<!DOCTYPE html>
<html>
<head>
    <title>WebRTC Peer 1</title>
</head>
<body>
    <h1>WebRTC Peer 1</h1>
    <textarea id="offer" cols="60" rows="10" placeholder="Offer SDP will appear here"></textarea><br>
    <textarea id="answer" cols="60" rows="10" placeholder="Paste Answer SDP here"></textarea><br>
    <textarea id="candidate" cols="60" rows="10" placeholder="Paste ICE Candidate here"></textarea><br>
    <button onclick="startConnection()">Start Connection</button>
    <button onclick="setAnswer()">Set Answer</button>
    <button onclick="addIceCandidate()">Add ICE Candidate</button>
    <textarea id="message" cols="60" rows="3" placeholder="Type message here"></textarea><br>
    <button onclick="sendMessage()">Send Message</button>
    <pre id="log"></pre>

    <script>
        let pc = new RTCPeerConnection({
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        let dataChannel = pc.createDataChannel("chat");

        dataChannel.onopen = () => {
            log("Data channel is open");
        };

        dataChannel.onmessage = (event) => {
            log(`Received message: ${event.data}`);
        };

        pc.onicecandidate = (event) => {
            if (event.candidate) {
                log(`New ICE candidate: ${JSON.stringify(event.candidate)}`);
            }
        };

        function startConnection() {
            pc.createOffer()
                .then(offer => pc.setLocalDescription(offer))
                .then(() => {
                    document.getElementById('offer').value = JSON.stringify(pc.localDescription);
                    log("Offer created and set as local description");
                });
        }

        function setAnswer() {
            let answer = JSON.parse(document.getElementById('answer').value);
            pc.setRemoteDescription(new RTCSessionDescription(answer))
                .then(() => log("Answer set as remote description"));
        }

        function addIceCandidate() {
            let candidate = JSON.parse(document.getElementById('candidate').value);
            pc.addIceCandidate(new RTCIceCandidate(candidate))
                .then(() => log("ICE candidate added"))
                .catch(e => log(`Failed to add ICE candidate: ${e}`));
        }

        function sendMessage() {
            let message = document.getElementById('message').value;
            dataChannel.send(message);
            log(`Sent message: ${message}`);
        }

        function log(message) {
            document.getElementById('log').textContent += `${message}\n`;
        }
    </script>
</body>
</html>
